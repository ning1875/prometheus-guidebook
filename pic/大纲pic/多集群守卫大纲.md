# k8s集群维护工作的重点 ：节点



# 项目背景：为什么需要guard工具
- 多集群的管理：集群多了，故障多了，没有自动处理工具应付不过来
- 异常节点的自动禁止：节点的异常影响，但是kubelet感知不到，还是往这个节点调度，运行的pod会有异常
- 异常pod的自动处理
- 自动恢复加入集群
- 集群中宕机机器多了的维修问题
- gpu坏卡自动 驱逐pod  维修机器


# 发现 上报 处理 恢复


# 设计模式 架构图


## 获取异常的标准
- prometheus查询
- agg_over_time 解决误报问题，确定问题已经持续了一段时间

## 无需关心


## 节点的异常影响，但是kubelet感知不到，还是往这个节点调度，运行的pod会有异常
- 基础架构守护程序问题：ntp 服务关闭；
- 硬件问题：CPU、内存或磁盘故障；
- 内核问题：内核死锁、损坏的文件系统；
- 容器运行时问题：无响应的运行时守护进程；

# 01 k8s节点的问题检测工具  https://github.com/kubernetes/node-problem-detector
- daemonset 部署到节点
- 检查各个方向的异常
- 给节点打condition 和event 上报到apiserver
- 交给其它处理组件处理


# 02 