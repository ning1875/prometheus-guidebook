



#  <font color=blue> 大运维平台5大模块</font>
- 01 资产管理 & cmdb & 服务树
- 02 工单 & 工作流 & 审批
- 03 cicd 全流程配置
- 04 Prometheus管理配置
- 05 k8s多集群管理

##  <font color=red>00 为什么是这5个模块</font>
- k8s/prometheus/cicd作为当下3大运维开发主流方向，这点大家都知道
- 但是如果只做上面3个模块还少了些基础的模块
- 这里的基础模块说的就是 cmdb和工单
- cmdb很好理解：
    - 监控/cicd/k8s等内部很多资源都属于资源
    - 资源就需要有管理的地方
    - 同时资产和服务的绑定形式应该是一颗服务树
    - 在服务树的节点上可以配置权限和绑定其他模块资源
        - 比如给 data.system.dns 绑定cicd发布模板可以发布dns配置
        - 比如给 infra.sre.apolloy绑定监控告警配置项
- 那么为什么还需要工单呢，主要原因有下面2点
    - 01 因为我们很多的操作需要工单审批之后才做
        - 比如 在页面上通过yaml编辑器编辑 k8s的deployment 会触发变更
        - 此时应该触发生成一张工单：经过预设的审批人审批后 再执行
    - 02 还有一些我们通用的运维工作需要工单支持
        - 比如调整安全组
        - 比如申请consul 服务发现token

## 树层级 总结服务树前端功能
- 每个树层级操作

    - 展开和折叠:
        - 默认只展开第一层
        - 每次点击下一层的展开按钮再展开 ：infra.k8s.prod-01.node.k8s-node-prod-01
    - 这个树节点内容：获取这个节点的机器列表

- 加载方式
    - 懒加载 异步  D:\nyy_work\fe-work\a-ben-yuan\src\views\demo\tree\index.vue
        - 数据不是一次请求完成
        - 而且根据父级再去查询子集
- 数据操作 ：右键菜单 beforeRightClick
    - 在父层级添加子集
    - 删除
- 工具栏使用 toolbar
- 函数操作按钮 D:\nyy_work\fe-work\a-ben-yuan\src\views\demo\tree\ActionTree.vue
- isLeaf 叶子节点：不能再有孩子了
- showLine 节点连线

## 服务树
- 服务树节点操作
    - 增加：右键添加
        - 父层级添加子层级
        - 节点属性：
            - 名称        name
            - 是否是子节点 isLeaf
            - 第几层级：  0,1,2,3
            - 父节点id：  parentId
            - 图标：      icon ：选择列表，而不是五花八门的
    - 删除：右键删除
        - 是否级联删除
        - 删除保护：如果子节点还有，那么不让删除父节点
    - 更新：根据id操作
        - 名称是可以更新的
    - 挪动节点？ 是否要做 ：也可以通过先删除后添加
- 树展示：查询
    - 一层一层的加载：默认全部展开是没有意义的
    - 数据是否异步：
        - 服务树特别庞大：全部数据前端渲染比较卡
        - 根据父层级查子层级：向下一层查询
        - 根据父层级展开所有层级：
- 不太想拼接 id形式 0-1-3-4

【3】工单 第1章 工单系统的调研工作
【3】工单 第2章 工单系统的工作流基础
【3】工单 第3章 工单系统的工作流接口联调
【3】工单 第4章 工单系统的表单设计
【3】工单 第5章 工单系统的工单模板和工单申请
【3】工单 第6章 工单创建和工单查询
【3】工单 第7章 工单的流转逻辑
【3】工单 第8章 工单的详情进度追踪
【3】工单 第9章 购买机器等的自动执行模块
【3】工单 第10章 工单和im通知
【3】工单 第2部分 详情进度追踪 自动执行模块 im通知

# 工单模块大纲
- 第1章 工单系统的调研工作
  - 1.1 回顾服务树和cmdb未完成的事情
  - 1.2 为什么要有工单系统
  - 1.3 开源工单系统调研
  - 1.4 工单系统核心对象-表单设计器
  - 1.5 工单系统核心对象-流程管理
  - 1.6 工单系统核心对象-排他网关
  - 1.7 工单系统再调研
  - 1.8 工单系统实现思路

- 第2章 工单系统的工作流基础
  - 2.1 设计工作流
  - 2.2 工作流节点
  - 2.3 工作流前端设计
  - 2.4 新增工单菜单
  - 2.5 动态增减表单项尝试01
  - 2.6 表格嵌套下拉列表
  - 2.7 新增流程的模态框
  - 2.8 尝试form和表格合并
  - 2.9 测试编辑能够带上信息
  - 2.10 测试编辑能够带上信息

- 第3章 工单系统的工作流接口联调
  - 3.1 获取申请人或组的接口
  - 3.2 整理新增的前端请求
  - 3.3 用户流程节点的一对多表关系
  - 3.4 完成后端新增流程的接口
  - 3.5 表格list流程
  - 3.6 表格美化
  - 3.7 流程更新接口
  - 3.8 删除流程接口

- 第4章 工单系统的表单设计
  - 4.1 大致的实现思路
  - 4.2 新增表单设计菜单
  - 4.3 表单设计打开和隐藏
  - 4.4 父子组件传递formConfig
  - 4.5 新增表单逻辑
  - 4.6 验证表单从json加载
  - 4.7 验证fApi提取表单数据
  - 4.8 后端创建和拉取api
  - 4.9 存量编辑页面展示
  - 4.10 formConfig和setField问题

- 第5章 工单系统的工单模板和工单申请
  - 5.1 新建菜单准备表结构
  - 5.2 新增时apiSelect选择关联对象
  - 5.3 查询和编辑和删除保护
  - 5.4 思考工单申请前端样式并mock模板数据
  - 5.5 card的v-for遍历
  - 5.6 工单申请跳转工单创建
  - 5.7 菜单隐藏和排序问题
  - 5.8 创建页面解析tplId查询接口
  - 5.9 查询展示遇到foreach遍历错误
  - 5.10 解决查询展示遇到foreach遍历错误

- 第6章 工单创建和工单查询
  - 6.1 工单创建页面
  - 6.2 思考工单核心对象的关系
  - 6.3 工单实例的字段
  - 6.4 工单的创建前端数据拼接
  - 6.5 工单的创建后端接口
  - 6.6 工单查询的几种模式和后续动作
  - 6.7 准备工单查询表格
  - 6.8 构造不同用户的工单
  - 6.9 改造所有的List接口支持分页
  - 6.10 前端指明查询模式

- 第7章 工单的流转逻辑
  - 7.1 工单流转节点逻辑
  - 7.2 工单创建初始化状态
  - 7.3 工单待我审批查询的逻辑
  - 7.4 通过不同状态给不同的action处理按钮
  - 7.5 新增用户来验证审批组过滤逻辑
  - 7.6 审批的后端接口
  - 7.7 验证工单审批
  - 7.8 审批拒绝工单和二次确认
  - 7.9 执行接口遇到问题
  - 7.10 执行接口最后一个节点更新问题

- 第8章 工单的详情进度追踪
  - 8.1 状态颜色
  - 8.2 按状态查询
  - 8.3 工单详情布局
  - 8.4 工单json数据回调表单探究01
  - 8.5 setFormModel-vs-fapi回填和表单禁用
  - 8.6 工单列表跳转工单详情
  - 8.7 工单列表跳转工单详情
  - 8.8 展示工单的时间轴
  - 8.9 调整时间轴显示
  - 8.10 进行工单完整测试
  - 8.11 完整测试下拉选择带搜索框
  - 8.12 工单评论前端组件
  - 8.13 工单评论后端接口
  - 8.14 工单评论问题解决和再次测试


- 第9章 购买机器等的自动执行模块
  - 9.1 思考自动执行和工单怎么整合
  - 9.2 定义后端的自动执行模块
  - 9.3 扫描接管的代码
  - 9.4 配置和工单模板联动
  - 9.5 拆分mockEcsOne方法
  - 9.6 虚拟机购买流程
  - 9.7 绑定服务树叶子节点
  - 9.8 后台提前创建虚拟机购买工单相关对象
  - 9.9 处理Comment错误
  - 9.10 调试创建流程
  - 9.11 验证服务树绑定


- 第10章 工单和im通知
  - 10.1 工单和im通知如何整合
  - 10.2 扫描工单找到待通知的用户
  - 10.3 遍历待处理的flowNode通知的逻辑
  - 10.4 验证通知处理人结果
  - 10.5 审批通知创建人的逻辑
  - 10.6 执行通知创建人的逻辑
  - 10.7 工单详情里面的动作按钮
  - 10.8 创建和是否关联控制按钮显示




# 




